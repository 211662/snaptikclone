<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Debug - SnapTik</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .test-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîß Admin Panel Debug Tool</h1>
        <p>Ki·ªÉm tra v√† debug admin panel loading issues</p>
        
        <div class="debug-section">
            <h3>üìä System Status</h3>
            <div id="authStatus" class="status loading">Checking authentication...</div>
            <div id="scriptsStatus" class="status loading">Loading scripts...</div>
            <div id="dataStatus" class="status loading">Loading data...</div>
        </div>

        <div class="debug-section">
            <h3>üõ†Ô∏è Quick Actions</h3>
            <button onclick="testAuth()">Test Authentication</button>
            <button onclick="clearStorage()">Clear All Storage</button>
            <button onclick="loadAdminDirect()">Load Admin Direct</button>
            <button onclick="resetSystem()">Reset System</button>
            <button onclick="testScripts()">Test Script Loading</button>
        </div>

        <div class="debug-section">
            <h3>üìã Available Tests</h3>
            <div class="test-grid">
                <div class="test-item">
                    <h4>Authentication Test</h4>
                    <button onclick="runAuthTest()">Run Test</button>
                    <div id="authTest">Not tested</div>
                </div>
                <div class="test-item">
                    <h4>LocalStorage Test</h4>
                    <button onclick="runStorageTest()">Run Test</button>
                    <div id="storageTest">Not tested</div>
                </div>
                <div class="test-item">
                    <h4>Script Loading Test</h4>
                    <button onclick="runScriptTest()">Run Test</button>
                    <div id="scriptTest">Not tested</div>
                </div>
                <div class="test-item">
                    <h4>TinyMCE Test</h4>
                    <button onclick="runTinyMCETest()">Run Test</button>
                    <div id="tinymceTest">Not tested</div>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>üìù Debug Log</h3>
            <button onclick="clearLog()">Clear Log</button>
            <div id="log"></div>
        </div>

        <div class="debug-section">
            <h3>üîó Quick Links</h3>
            <a href="login.html" style="margin-right: 15px;">Login Page</a>
            <a href="admin.html" style="margin-right: 15px;">Admin Panel</a>
            <a href="blog.html" style="margin-right: 15px;">Blog</a>
            <a href="blog-demo.html">Demo Page</a>
        </div>
    </div>

    <script src="js/login.js"></script>
    <script>
        let logContent = '';

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logContent += `[${timestamp}] ${message}\n`;
            document.getElementById('log').textContent = logContent;
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logContent = '';
            document.getElementById('log').textContent = '';
        }

        function setStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `status ${status}`;
            element.textContent = message;
        }

        function testAuth() {
            log('Testing authentication...');
            try {
                if (typeof LoginManager !== 'undefined') {
                    const isAuth = LoginManager.isAuthenticated();
                    const currentUser = LoginManager.getCurrentUser();
                    log(`Auth Status: ${isAuth ? 'Authenticated' : 'Not authenticated'}`);
                    log(`Current User: ${currentUser || 'None'}`);
                    setStatus('authStatus', isAuth ? 'success' : 'error', 
                             isAuth ? `Authenticated as ${currentUser}` : 'Not authenticated');
                } else {
                    log('ERROR: LoginManager not found');
                    setStatus('authStatus', 'error', 'LoginManager not loaded');
                }
            } catch (error) {
                log(`Auth test error: ${error.message}`);
                setStatus('authStatus', 'error', 'Authentication test failed');
            }
        }

        function clearStorage() {
            log('Clearing all storage...');
            localStorage.clear();
            sessionStorage.clear();
            log('Storage cleared');
        }

        function loadAdminDirect() {
            log('Loading admin panel directly...');
            window.location.href = 'admin.html';
        }

        function resetSystem() {
            log('Resetting system...');
            clearStorage();
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        function testScripts() {
            log('Testing script availability...');
            const scripts = ['LoginManager', 'tinymce'];
            let allLoaded = true;
            
            scripts.forEach(script => {
                if (typeof window[script] !== 'undefined') {
                    log(`‚úì ${script} loaded`);
                } else {
                    log(`‚úó ${script} not loaded`);
                    allLoaded = false;
                }
            });
            
            setStatus('scriptsStatus', allLoaded ? 'success' : 'error', 
                     allLoaded ? 'All scripts loaded' : 'Some scripts missing');
        }

        function runAuthTest() {
            testAuth();
            document.getElementById('authTest').textContent = 'Test completed - check log';
        }

        function runStorageTest() {
            log('Testing localStorage...');
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                document.getElementById('storageTest').textContent = value === 'value' ? '‚úì Working' : '‚úó Failed';
                log('localStorage test: ' + (value === 'value' ? 'PASSED' : 'FAILED'));
            } catch (error) {
                document.getElementById('storageTest').textContent = '‚úó Error: ' + error.message;
                log('localStorage test ERROR: ' + error.message);
            }
        }

        function runScriptTest() {
            testScripts();
            document.getElementById('scriptTest').textContent = 'Test completed - check log';
        }

        function runTinyMCETest() {
            log('Testing TinyMCE...');
            if (typeof tinymce !== 'undefined') {
                document.getElementById('tinymceTest').textContent = '‚úì TinyMCE available';
                log('TinyMCE test: PASSED');
            } else {
                document.getElementById('tinymceTest').textContent = '‚úó TinyMCE not loaded';
                log('TinyMCE test: FAILED - not loaded');
            }
        }

        // Auto-run basic tests on load
        window.addEventListener('load', function() {
            log('Debug tool loaded');
            setTimeout(() => {
                testAuth();
                testScripts();
                
                // Check data
                try {
                    const savedPosts = localStorage.getItem('snaptik_blog_posts');
                    const postCount = savedPosts ? JSON.parse(savedPosts).length : 0;
                    setStatus('dataStatus', 'success', `${postCount} posts in storage`);
                    log(`Data Status: ${postCount} posts found in localStorage`);
                } catch (error) {
                    setStatus('dataStatus', 'error', 'Data loading failed');
                    log(`Data Status ERROR: ${error.message}`);
                }
            }, 500);
        });
    </script>
</body>
</html>